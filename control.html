<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>13cm Iframe Snap Grid</title>
<style>
body {
  font-family: sans-serif;
  margin: 0;
  padding: 1cm;
}

#toolbar {
  margin-bottom: 1cm;
}

#addBtn {
  font-size: 18px;
  padding: 4px 10px;
  cursor: pointer;
}

#grid {
  position: relative;
  width: 100%;
  min-height: 100vh;
  border: 1px solid #ccc;
}

/* container holding drag handle + iframe */
.iframe-wrapper {
  position: absolute;
  display: flex;
  flex-direction: column;
  cursor: grab;
}

.drag-handle {
  height: 1cm;
  background: #ddd;
  text-align: center;
  line-height: 1cm;
  font-weight: bold;
  user-select: none;
  cursor: grab;
}

/* the iframe itself */
.iframe-wrapper iframe {
  width: 13cm;
  height: 13cm;
  border: 2px solid #888;
  display: block;
}
</style>
</head>
<body>

<div id="toolbar">
  <button id="addBtn">＋ Add</button>
</div>

<div id="grid"></div>

<script>
const grid = document.getElementById("grid");
const addBtn = document.getElementById("addBtn");
let zIndexCounter = 1;
const GRID_SIZE_CM = 13; // iframe size
const GRID_GAP_CM = 0.5; // gap
const CM_TO_PX = 37.795; // approx conversion

// create iframe container with drag handle
function createIframe(x = 20, y = 20) {
  const wrapper = document.createElement("div");
  wrapper.className = "iframe-wrapper";
  wrapper.style.left = x + "px";
  wrapper.style.top = y + "px";
  wrapper.style.zIndex = zIndexCounter++;

  const handle = document.createElement("div");
  handle.className = "drag-handle";
  handle.textContent = "⇅ Drag";

  const iframe = document.createElement("iframe");
  iframe.src = "unit.html"; // your iframe HTML

  wrapper.appendChild(handle);
  wrapper.appendChild(iframe);
  grid.appendChild(wrapper);

  makeDraggable(wrapper, handle);
}

// smooth dragging with snap on pointerup
function makeDraggable(wrapper, handle) {
  let offsetX = 0;
  let offsetY = 0;

  handle.addEventListener("pointerdown", (e) => {
    offsetX = e.clientX - wrapper.offsetLeft;
    offsetY = e.clientY - wrapper.offsetTop;
    wrapper.style.zIndex = zIndexCounter++;
    handle.setPointerCapture(e.pointerId);
  });

  handle.addEventListener("pointermove", (e) => {
    if (e.buttons !== 1) return;
    wrapper.style.left = (e.clientX - offsetX) + "px";
    wrapper.style.top = (e.clientY - offsetY) + "px";
  });

  handle.addEventListener("pointerup", (e) => {
    handle.releasePointerCapture(e.pointerId);

    // snap to grid
    const gridPx = GRID_SIZE_CM * CM_TO_PX;
    const gapPx = GRID_GAP_CM * CM_TO_PX;

    const snapX = Math.round(wrapper.offsetLeft / (gridPx + gapPx)) * (gridPx + gapPx);
    const snapY = Math.round(wrapper.offsetTop / (gridPx + gapPx)) * (gridPx + gapPx);

    wrapper.style.left = snapX + "px";
    wrapper.style.top = snapY + "px";
  });
}

// add new iframe
addBtn.addEventListener("click", () => {
  createIframe(
    20 + Math.random() * (window.innerWidth - 400),
    20 + Math.random() * (window.innerHeight - 400)
  );
});

// initial layout: 3 iframes
for (let i = 0; i < 3; i++) {
  createIframe(20 + i * (13.5*CM_TO_PX), 20);
}
</script>

</body>
</html>
