<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Iframe Drag Grid (Correct)</title>

<style>
  body {
    font-family: sans-serif;
  }

  #toolbar {
    margin-bottom: 1cm;
  }

  #addBtn {
    font-size: 18px;
    padding: 4px 10px;
    cursor: pointer;
  }

  #grid {
    position: relative;
    width: 100%;
    min-height: 100vh;
  }

  .iframe-wrapper {
    position: absolute;
    width: 10cm;
    height: 10cm;
    border: 2px solid #888;
    background: #fff;
  }

  .drag-handle {
    height: 0.8cm;
    background: #ddd;
    cursor: grab;
    text-align: center;
    line-height: 0.8cm;
    user-select: none;
    font-weight: bold;
  }

  iframe {
    width: 100%;
    height: calc(100% - 0.8cm);
    border: none;
  }
</style>
</head>

<body>

<div id="toolbar">
  <button id="addBtn">＋ Add</button>
</div>

<div id="grid"></div>

<script>
const grid = document.getElementById("grid");
const addBtn = document.getElementById("addBtn");

let zIndex = 1;

function createIframe(x = 20, y = 20) {
  const wrapper = document.createElement("div");
  wrapper.className = "iframe-wrapper";
  wrapper.style.left = x + "px";
  wrapper.style.top = y + "px";
  wrapper.style.zIndex = zIndex++;

  const handle = document.createElement("div");
  handle.className = "drag-handle";
  handle.textContent = "⇅ Drag";

  const iframe = document.createElement("iframe");
  iframe.src = "unit.html";

  wrapper.appendChild(handle);
  wrapper.appendChild(iframe);
  grid.appendChild(wrapper);

  makeDraggable(wrapper, handle);
}

function makeDraggable(wrapper, handle) {
  let offsetX, offsetY;

  handle.addEventListener("pointerdown", (e) => {
    offsetX = e.clientX - wrapper.offsetLeft;
    offsetY = e.clientY - wrapper.offsetTop;
    wrapper.setPointerCapture(e.pointerId);
    wrapper.style.zIndex = zIndex++;
  });

  handle.addEventListener("pointermove", (e) => {
    if (e.buttons !== 1) return;
    wrapper.style.left = (e.clientX - offsetX) + "px";
    wrapper.style.top = (e.clientY - offsetY) + "px";
  });

  handle.addEventListener("pointerup", (e) => {
    wrapper.releasePointerCapture(e.pointerId);
  });
}

addBtn.addEventListener("click", () => {
  createIframe(40 + Math.random() * 200, 40 + Math.random() * 200);
});

// Start with one
createIframe();
</script>

</body>
</html>
