<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Iframe Grid (cm units)</title>

<style>
  body {
    font-family: sans-serif;
  }

  #toolbar {
    margin-bottom: 1cm;
  }

  #addBtn {
    font-size: 18px;
    padding: 4px 10px;
    cursor: pointer;
  }

  #grid {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5cm;
  }

  .iframe-wrapper {
    width: 10cm;
    height: 10cm;
    border: 2px solid #888;
    display: flex;
    flex-direction: column;
    background: #fff;
  }

  .drag-handle {
    height: 0.8cm;
    background: #ddd;
    cursor: grab;
    text-align: center;
    line-height: 0.8cm;
    user-select: none;
    font-weight: bold;
  }

  .drag-handle:active {
    cursor: grabbing;
  }

  iframe {
    flex: 1;
    border: none;
    width: 100%;
  }
</style>
</head>

<body>

<div id="toolbar">
  <button id="addBtn">＋ Add</button>
</div>

<div id="grid"></div>

<script>
const grid = document.getElementById("grid");
const addBtn = document.getElementById("addBtn");

let dragged = null;

function createIframe() {
  const wrapper = document.createElement("div");
  wrapper.className = "iframe-wrapper";

  const handle = document.createElement("div");
  handle.className = "drag-handle";
  handle.textContent = "⇅ Drag";

  const iframe = document.createElement("iframe");
  iframe.src = "unit.html"; // same-origin

  wrapper.appendChild(handle);
  wrapper.appendChild(iframe);
  grid.appendChild(wrapper);

  setupDrag(handle, wrapper);
}

function setupDrag(handle, wrapper) {
  handle.draggable = true;

  handle.addEventListener("dragstart", () => {
    dragged = wrapper;
    wrapper.style.opacity = "0.5";
  });

  handle.addEventListener("dragend", () => {
    wrapper.style.opacity = "1";
    dragged = null;
  });

  wrapper.addEventListener("dragover", (e) => {
    e.preventDefault();
  });

  wrapper.addEventListener("drop", () => {
    if (!dragged || dragged === wrapper) return;

    const children = [...grid.children];
    const draggedIndex = children.indexOf(dragged);
    const targetIndex = children.indexOf(wrapper);

    if (draggedIndex < targetIndex) {
      grid.insertBefore(dragged, wrapper.nextSibling);
    } else {
      grid.insertBefore(dragged, wrapper);
    }
  });
}

addBtn.addEventListener("click", createIframe);

// Start with some
for (let i = 0; i < 3; i++) createIframe();
</script>

</body>
</html>
