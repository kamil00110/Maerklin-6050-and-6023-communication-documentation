<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Iframe Grid Drag</title>

<style>
  body {
    font-family: sans-serif;
  }

  #toolbar {
    margin-bottom: 1cm;
  }

  #addBtn {
    font-size: 18px;
    padding: 4px 10px;
    cursor: pointer;
  }

  #grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, 10cm);
    gap: 0.5cm;
  }

  .iframe-wrapper {
    width: 10cm;
    height: 10cm;
    border: 2px solid #888;
    background: white;
    display: flex;
    flex-direction: column;
  }

  .drag-handle {
    height: 0.8cm;
    background: #ddd;
    cursor: grab;
    user-select: none;
    text-align: center;
    line-height: 0.8cm;
    font-weight: bold;
  }

  .dragging {
    opacity: 0.6;
  }

  iframe {
    flex: 1;
    border: none;
    width: 100%;
  }
</style>
</head>

<body>

<div id="toolbar">
  <button id="addBtn">＋ Add</button>
</div>

<div id="grid"></div>

<script>
const grid = document.getElementById("grid");
const addBtn = document.getElementById("addBtn");

let dragged = null;

function createIframe() {
  const wrapper = document.createElement("div");
  wrapper.className = "iframe-wrapper";

  const handle = document.createElement("div");
  handle.className = "drag-handle";
  handle.textContent = "⇅ Drag";

  const iframe = document.createElement("iframe");
  iframe.src = "unit.html";

  wrapper.appendChild(handle);
  wrapper.appendChild(iframe);
  grid.appendChild(wrapper);

  makeDraggable(wrapper, handle);
}

function makeDraggable(item, handle) {
  let startX, startY;

  handle.addEventListener("pointerdown", (e) => {
    dragged = item;
    item.classList.add("dragging");
    startX = e.clientX;
    startY = e.clientY;
    handle.setPointerCapture(e.pointerId);
  });

  handle.addEventListener("pointermove", (e) => {
    if (!dragged) return;

    const el = document.elementFromPoint(e.clientX, e.clientY);
    const target = el?.closest(".iframe-wrapper");

    if (target && target !== dragged && target.parentNode === grid) {
      const items = [...grid.children];
      const draggedIndex = items.indexOf(dragged);
      const targetIndex = items.indexOf(target);

      if (draggedIndex < targetIndex) {
        grid.insertBefore(dragged, target.nextSibling);
      } else {
        grid.insertBefore(dragged, target);
      }
    }
  });

  handle.addEventListener("pointerup", (e) => {
    dragged?.classList.remove("dragging");
    dragged = null;
    handle.releasePointerCapture(e.pointerId);
  });
}

addBtn.addEventListener("click", createIframe);

// Start with a few
for (let i = 0; i < 3; i++) createIframe();
</script>

</body>
</html>
